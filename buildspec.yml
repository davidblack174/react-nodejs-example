version: 0.2

phases:
  install:
    runtime-versions:
      docker: latest
    commands:
      - echo "Installing Docker..."
      - sudo yum update -y
      - sudo yum install -y docker
      - nohup dockerd > /tmp/dockerd.log 2>&1 &
      - sleep 10  # Give Docker time to start
      - sudo chmod 666 /var/run/docker.sock
      - docker --version

  build:
    commands:
      - echo "Building and saving Docker image..."
      - cd my-app
      - docker build -t my-app .
      - docker save -o my-app.tar my-app

artifacts:
  files:
    - my-app.tar
  discard-paths: no
  name: my-app-artifacts
  s3-prefix: simplifify-it

cache:
  paths:
    - '/root/.docker/**'

env:
  variables:
    AWS_DEFAULT_REGION: us-east-1
